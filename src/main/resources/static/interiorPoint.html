<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Bitter" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <style>
        td,
        th {
            text-align: center;
            min-width: 150px;
        }

        .expand {
            width: 100%;
            height: 100%;
        }

        body {
            font-family: 'Bitter', serif;
        }

        input[type=number] {
            width: 100%;
        }


    </style>
</head>

<body>
    <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->


    <div class="container-fluid">
        <div class="table-responsive">
            <h2 class="text-center">Objective Function</h2>
            <table class="table table-bordered" id="result" width="100%" cellspacing="0">
                <thead class="bg-primary">
                    <tr id="of-head">
                        <th>
                            Type
                        </th>
                        <th>
                            X1
                        </th>
                        <th>
                            X2
                        </th>
                        <th>
                            X3
                        </th>


                    </tr>
                </thead>
                <tbody id="of-body">
                    <tr>
                        <td>
                            <select>
                                <option>MAXIMIZE</option>
                                <option>MINIMIZE</option>

                            </select>
                        </td>
                        <td><input type="number" step="0.01" required></td>
                        <td><input type="number" step="0.01" required></td>
                        <td><input type="number" step="0.01" required></td>


                    </tr>


                </tbody>




            </table>

        </div>
        <hr>
        <div class="table-responsive">
            <h2 class="text-center">Constraint Table</h2>
            <table class="table table-bordered" width="100%" cellspacing="0">
                <thead class="bg-primary">
                    <tr id="thead-tr">
                        <th>
                            X1
                        </th>
                        <th>
                            X2
                        </th>
                        <th>
                            X3
                        </th>
                        <th>
                            Type
                        </th>
                        <th>
                            Value
                        </th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <tr>
                        <td><input type="number" step="0.01" required></td>
                        <td><input type="number" step="0.01" required></td>
                        <td><input type="number" step="0.01" required></td>
                        <td> <select>
                                <option>&lt=</option>
                                <option>&gt=</option>
                                <option>=</option>
                            </select>
                        </td>
                        <td><input type="number" step="0.01" required></td>
                    </tr>


                </tbody>




            </table>


        </div>
        <hr>
        <div class="row row-eq-height">
            <div class="col text-center"><button class="btn btn-outline-primary expand" onclick="addCons()">Add
                    Constraint</button>
            </div>
            <div class="col text-center"> <button class="btn btn-outline-primary expand" onclick="addVar()">Add
                    Variable</button>
            </div>
            <div class="col text-center"> <button class="btn btn-outline-primary expand" onclick="removeCons()">Remove
                    Constraint</button></div>
            <div class="col text-center"> <button class="btn btn-outline-primary expand" onclick="removeVar()">Remove
                    Variable</button></div>
        </div>
        <br>
        <div class="row text-center">
                <div class="col text-center"><button class="btn btn-outline-success expand" onclick="solveModel()">Solve</button>
            </div>
            
        </div>
        <hr>
        <div id="resultTable-cont" class="table-responsive">
            <h2 class="text-center">Results</h2>
            <table class="table table-bordered"  width="100%" cellspacing="0" id="resultTable">
                <thead class="bg-primary">
                    <td> X1</td>
                    <td>X2</td>
                    <td>X3</td>
                    <td>Z
                    </td>
                    <td>Is Feasible
                    </td>
                </thead>
                <tbody>

                </tbody>




            </table>


        </div>


    </div>







    <script>
        var varCount = 3;
        var consCount = 1;

        $(document).ready(function () {
            $("#resultTable-cont").hide();
        });


        function addCons() {
            $("#table-body").append(generateNewConsRow(varCount));
            consCount++;
        }

        function removeVar() {
            if (varCount > 2) {
                $("#thead-tr th:nth-child(" + (varCount) + ")").remove();
                $("#table-body tr td:nth-child(1)").remove();

                $("#of-head th:nth-child(" + (varCount + 1) + ")").remove();
                $("#of-body tr td:nth-child(2)").remove();
                varCount--;
            }

        }

        function generateNewConsRow(count) {
            var st = "<tr>";
            for (let index = 0; index < count; index++) {
                st += "<td><input type='number' step='0.01' required></td>";

            }
            st += "<td> <select><option>&lt=</option><option>&gt=</option><option>=</option></select></td><td><input type='number' step='0.01' required></td></tr>"
            return st;
        }

        function removeCons() {
            if (consCount > 1) {
                $("#table-body tr").last().remove();
                consCount--;
            }

        }

        function addVar() {
            $("#thead-tr th:nth-child(" + (varCount) + ")").after("<th>X" + (varCount + 1) + "</th>");
            $("#table-body tr").prepend("<td><input type='number' step='0.01' required></td>");

            $("#of-head th:nth-child(" + (varCount + 1) + ")").after("<th>X" + (varCount + 1) + "</th>");
            $("#of-body tr").append("<td><input type='number' step='0.01' required></td>");


            varCount++;
        }

        function insertAtIndex(i) {
            if (i === 0) {
                $("#controller").prepend("<div>okay things</div>");
                return;
            }


            $("#controller > div:nth-child(" + (i) + ")").after("<div>great things</div>");
        }


        function constructQueryString() {
            type = "";
            obfun = "";
            vars = "";
            constraints = "";
            $('#of-body td').each(function (index) {
                if (index == 0) {
                    type = ($(this).find('select').val());

                } else {
                    obfun += $(this).find('input').val() + ",";
                }
            });
            for (i = 0; i < varCount; i++) {
                vars += "X" + (i + 1) + ":C" + ",";
            }

            $('#table-body tr').each(function (i) {
                $(this).find('td').each(function (j) {

                    if (j < varCount || j == varCount + 1) {

                        if (j == varCount + 1) {
                            constraints += $(this).find('input').val() + ";";
                        } else {

                            constraints += $(this).find('input').val() + ",";
                        }
                    } else {
                        constraints += $(this).find('select').val() + ",";
                    }
                });

            });

            vars = vars.substring(0, vars.length - 1);
            obfun = obfun.substring(0, obfun.length - 1);
            console.log("?type=" + type + "&vars=" + vars + "&objectiveFunction=" + obfun + "&constraints=" + constraints);
            return "?type=" + type + "&vars=" + vars + "&objectiveFunction=" + obfun + "&constraints=" + constraints;

        }

        function solveModel() {
            /*                 $(".cover").toggle(400); */
            var string = constructQueryString();
            $.ajax({
                url: "https://icesiviptest.herokuapp.com/interiorPoint" + string
            }).then(function (data) {
                /*                     $(".cover").toggle(400); */
                console.log(data);
                $('#resultTable').DataTable().destroy();
                $("#resultTable thead").empty();
                $("#resultTable tbody").empty();
                var p1 = new Promise((resolve, reject) => {

                    $("#resultTable thead").append("<tr></tr>");
                    $("#resultTable thead").find("tr").append("<th>Step</th>");
                    for (index = 0; index < varCount; index++) {
                        $("#resultTable thead").find("tr").append("<th>" + "X" + (index + 1) + "</th>");

                    }
                    $("#resultTable thead").find("tr").append("<th>Z</th>");
                    $("#resultTable thead").find("tr").append("<th>Is Feasible</th>");
                    $("#resultTable-cont").show();
                    console.log("Se agregaron las nuevs columnas");

                    resolve();

                });
                p1.then(() => {
                    $('#resultTable').DataTable();
                    console.log("termino la basura")
                    data.solutionPath.forEach((element, index) => {
                        arr = [];
                        arr.push(index);
                        for (var key in element.variables) {
                            arr.push(element.variables[key].toFixed(5));
                        }
                        arr.push(element.z.toFixed(5));
                        arr.push(element.feasible);
                        $('#resultTable').DataTable().row.add(arr).draw();
                        
                    });
                    $('#resultTable').DataTable().data().reverse();
                }).catch((error) => { console.log(error) });



            }, function (error) {
                alert("Failed to process request, model may be unsolvable.")
                /*                     $(".cover").toggle(400); */
                console.log(error);
            });
        }




    </script>
    <script src="vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="js/demo/datatables-demo.js"></script>
</body>

</html>